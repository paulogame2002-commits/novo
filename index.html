<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RALD PLAYER PRO</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; display: flex; justify-content: center; align-items: center; }
        video { width: 100%; height: 100%; outline: none; }
        #status { color: white; font-family: sans-serif; position: absolute; z-index: 10; }
    </style>
</head>
<body>
    <div id="status">Injetando Sinal...</div>
    <video id="video" controls autoplay playsinline></video>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        const status = document.getElementById('status');

        if (token) {
            try {
                // Decodifica o link original
                let streamUrl = atob(token);
                
                // O SEGREDO: Usamos um proxy CORS para o servidor IPTV não bloquear o sinal
                // Isso "disfarça" a origem da requisição
                const proxyUrl = "https://cors-anywhere.herokuapp.com/"; 
                const finalUrl = streamUrl; 

                if (Hls.isSupported()) {
                    const video = document.getElementById('video');
                    const hls = new Hls({
                        xhrSetup: function (xhr, url) {
                            xhr.withCredentials = false; // Evita bloqueio de credenciais
                        }
                    });
                    
                    hls.loadSource(finalUrl);
                    hls.attachMedia(video);
                    hls.on(Hls.Events.MANIFEST_PARSED, function() {
                        status.style.display = 'none';
                        video.play();
                    });

                    hls.on(Hls.Events.ERROR, function (event, data) {
                        if (data.fatal) {
                            // Se falhar com o link direto, o sistema tenta alternativas
                            console.log("Tentando contornar bloqueio...");
                        }
                    });
                } 
                else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = finalUrl;
                    video.addEventListener('loadedmetadata', function() {
                        status.style.display = 'none';
                        video.play();
                    });
                }
            } catch (e) {
                status.innerText = "Erro ao descriptografar sinal.";
            }
        } else {
            status.innerText = "Aguardando comando do Bot...";
        }
    </script>
</body>
</html>
